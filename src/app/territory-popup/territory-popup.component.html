<div class="modal fade" id="territoryPopup" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document" style="max-width: 400px;">
		<div class="modal-content" *ngIf="selectedTerritory">
			<div class="modal-header"
				style="line-height: 40px; vertical-align: middle; background-color: #337ab7;  border: 0">
				<img *ngIf="selectedTerritory" src="assets/graphics/images/{{selectedTerritory.flag || 'flag1.gif'}}"
					title="{{superpowersData.superpowers[selectedTerritory.owner]}}" height=40>
				&nbsp;<span style="font-size: 24px; font-weight: 700;">{{selectedTerritory.name}}</span>
				&nbsp;<span style="color: #ccc;">{{selectedTerritory.userName}}</span>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body" style="padding: 0; text-align: center;">

				<app-terr-header [selectedTerritory]="selectedTerritory"></app-terr-header>

				<app-terr-buttons [selectedTerritory]="selectedTerritory" [currentPlayer]="currentPlayer"
					[superpowersData]="superpowersData" [gameObj]="gameObj" [user]="user" [optionType]="optionType"
					[ableToTakeThisTurn]="ableToTakeThisTurn" (messageEvent)="buttonClicked($event)"></app-terr-buttons>

				<app-terr-units *ngIf="optionType=='home'" [selectedTerritory]="selectedTerritory"
					[currentPlayer]="currentPlayer" [superpowersData]="superpowersData" [gameObj]="gameObj"
					[user]="user"></app-terr-units>

				<div *ngIf="optionType!='home'" class="terr-card">
					Troop Movement [{{optionType}}]
					<div *ngIf="loadingFlg" class="progress-bar progress-bar-info progress-bar-striped"
						role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">
						Busy...
					</div>
					<div *ngIf="!loadingFlg" style="background-color: #ccc; color: black;">
						<div
							*ngIf="(optionType=='movement' || optionType=='loadUnits') && selectedTerritory.nation==99 && selectedTerritory.unitCount>0">
							<button *ngIf="optionType=='movement'" (click)="optionType='loadUnits'" type="button"
								class="btn btn-success roundButton"><i class="fa fa-ship"></i> Custom Load
								Options</button>
							<button *ngIf="optionType=='loadUnits'" (click)="optionType='movement'" type="button"
								class="btn btn-success roundButton"><i class="fa fa-ship"></i> Auto Load</button>

							<button (click)="infoFlg = !infoFlg" type="button" class="btn btn-secondary roundButton"><i
									class="fa fa-info-circle"></i> Info</button>
							<div *ngIf="infoFlg" class="borderClass2">
								<div>Cargo Limits</div>
								<table class="spTable">
									<tr>
										<th>Ship</th>
										<th>Cargo</th>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece4u.png" height=30></td>
										<td><img src="assets/graphics/units/piece2u.png" height=30><img
												src="assets/graphics/units/piece2u.png" height=30><img
												src="assets/graphics/units/piece2u.png" height=30><img
												src="assets/graphics/units/piece2u.png" height=30></td>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece4u.png" height=30></td>
										<td><img src="assets/graphics/units/piece3u.png" height=30><img
												src="assets/graphics/units/piece3u.png" height=30></td>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece8u.png" height=30></td>
										<td><img src="assets/graphics/units/piece6u.png" height=30><img
												src="assets/graphics/units/piece6u.png" height=30></td>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece12u.png" height=30></td>
										<td><img src="assets/graphics/units/piece13u.png" height=30><img
												src="assets/graphics/units/piece10u.png" height=30><img
												src="assets/graphics/units/piece11u.png" height=30></td>
									</tr>
								</table>
								<div> all ships can carry heros and AA guns.</div>
							</div>
							<div *ngIf="optionType=='movement'">Select units to load. They will automatically be loaded
								onto ships.</div>
							<div *ngIf="optionType=='loadUnits'">Select one ship plus cargo you want to load.</div>
						</div>

						<div *ngIf="optionType=='loadPlanes'" class="borderClass">Select units to load as paratroopers.
							<button (click)="infoFlg = !infoFlg" type="button" class="btn ptp-gray roundButton"
								style=""><i class="fa fa-info-circle"></i>Info</button>
							<div *ngIf="infoFlg">Each bomber can carry up to 2 infantry, plus hero units. Only select
								the infantry. Bombers are chosen automatically for you.</div>
						</div>
						totalUnitsThatCanMove: {{totalUnitsThatCanMove}} totalAttackStrength {{totalAttackStrength}}
						<div *ngFor="let terr of moveTerr; let i = index" [ngStyle]="ngStyleTerr(terr, i)"
							class="terrClass">
							<div style="padding-left: 5px; font-size: 18px; font-weight: 700; text-align: left;">
								{{terr.name}}

								<!--<span>
									<svg *ngIf="terr.svg.path.length>0" style="height: 51px; max-width: 100px;"
										[attr.viewBox]="{{terr.svg.viewBox}}">
										<g id="svg2{{terr.svg.id}}" fill="white" stroke="black" stroke-width="30">
											<path [attr.d]="{{terr.svg.path}}" />
										</g>
									</svg>
								</span>-->
								<span style="float: right;">
									<span *ngIf="terr.movableTroopCount >= 2" style="font-size: 10px;">Select All
									</span>
									<div *ngIf="terr.units.length>=2" class="squaredOne squaredOneGreen"
										style="display: inline-block; padding: 0; margin: 1px;">
										<input (click)="selectAllUnitsForTerr(terr)" type="checkbox" value="None"
											id="{{'ter'+terr.id}}" name="check" />
										<label for="{{'ter'+terr.id}}"></label>

									</div>
								</span>
							</div>
							<hr style="padding: 0; margin: 5px;">
							terr.distObj: {{terr.distObj.land}} {{terr.distObj.air}} {{terr.distObj.sea}}
							<div *ngFor="let unit of terr.units" style="display: inline-block;">
								<span *ngIf="checkMovement(terr.distObj, unit)">
									<div (click)="checkSendButtonStatus(unit)" class="squaredOne"
										style="display: inline-block; padding: 0; margin: 1px;">
										<input type="checkbox" value="None" id="{{'unit'+unit.id}}" name="check" />
										<label for="{{'unit'+unit.id}}"></label>
									</div> <i class="fa fa-hourglass-half"
										*ngIf="unit.piece==28 && gameObj.round-1 == unit.medicRound"></i>
									<span style="margin-right: 10px;"> <img *ngIf="unit.piece>0"
											ng-click="unitPopup(unit.piece)"
											src="{{ngUnitSrc(unit.piece, unit.nation)}}" height=20
											title="{{unit.name}}"><span *ngIf="unit.cargoOf>0">(c)</span><span
											*ngFor="let cargo of unit.cargo"><img src="{{ngUnitSrc(cargo.piece)}}"
												height=10></span></span>
								</span>
							</div>
							<div *ngIf="selectedUnitForm==terr.id"
								style="margin-top: 5px; border: 1px solid gray; display: block; white-space: nowrap;">
								({{selectedFormUnit.max}})
								<img ng-if="1" ng-click="unitPopup(2)" src="{{ngUnitSrc(selectedFormUnit.piece, 1)}}"
									style="max-height: 30px; max-width: 40px;">
								<button disabled id="unitCountToOne" ng-click="unitCountToZero(terr)" type="button"
									class="btn btn-primary tight roundButton"><i
										class="fa fa-fast-backward"></i></button>
								<button disabled id="unitCountDown" ng-click="unitCountDownF(terr)" type="button"
									class="btn btn-primary tight roundButton"><i class="fa fa-backward"></i></button>
								<button id="unitCountUp" ng-click="unitCountUpF(terr)" type="button"
									class="btn btn-primary tight roundButton"><i class="fa fa-forward"></i></button>
								<button id="unitCountToMax" ng-click="setUnitCountToMax(terr)" type="button"
									class="btn btn-primary tight roundButton"><i
										class="fa fa-fast-forward"></i></button>
								<span
									style="background-color: white; border: 1px solid black; font-size: 18px; padding: 1px;">{{selectedFormUnit.num}}</span>
							</div>

						</div> <!-- each terr-->
						<div *ngIf="hostileMessage.length>0 && totalUnitsThatCanMove>0"
							style="background-color: yellow; color: red; font-weight: 700;"><i class="fa fa-exclamation-triangle"></i> {{hostileMessage}}</div>
						<div *ngIf="totalUnitsThatCanMove==0" style="background-color: yellow; border: 1px solid red;">
							<div style="color: red; font-weight: 700;"><i class="fa fa-exclamation-triangle"></i> None
								of your units can reach {{selectedTerritory.name}}!</div>
							<div ng-show="gameObj.round<6 && !gameObj.multiPlayerFlg">This may be due to all your units
								having used up their moves for this turn. Click 'Complete Turn' to move to next turn.
							</div>
						</div>
						<div>
							<button *ngIf="optionType=='attack'" ng-click="autoButtonPressed()" type="button"
								class="btn btn-secondary roundButton"><i class="fa fa-check-square-o"></i> Auto</button>
							<button (click)="selectAllButtonChecked()" type="button"
								class="btn btn-secondary roundButton"><i class="fa fa-check-square-o"></i> All</button>
							<button (click)="moveTroopsButtonPressed()" [disabled]="totalAttackStrength==0" type="button"
								class="btn btn-success roundButton" style="min-width: 120px; height: 50px;"><i
									class="fa fa-arrow-right"></i> Go</button>

						</div>
						<div *ngIf="optionType=='attack' || optionType=='nuke'" style="font-size: 12px;">
							Expected Hits: <span class="highlightField">{{expectedHits}}</span>
							Expected Losses: <span class="highlightField">{{selectedTerritory.expectedLosses}}</span>
						</div>


					</div>
				</div>
				<!------------------Production Queue----------------------------->
				<div *ngIf="optionType=='home' && selectedTerritory.treatyStatus==4 && selectedTerritory.displayQueue.length>0"
					class="terr-card">
					<div style="font-size: 10px; color: white;"><i class="fa fa-building-o"></i> Production
						Queue
					</div>
					<div style="background-color: white;">
						<span *ngIf="selectedTerritory.displayQueue.length==0">&nbsp;</span>
						<span *ngFor="let unit of selectedTerritory.displayQueue"><img *ngIf="unit.piece>0"
								src="{{ngUnitSrc(unit.piece, 1)}}" height=20
								title="{{superpowersData.units[unit.piece].name}}"><span
								*ngIf="unit.count>1">({{unit.count}})</span>
						</span>
						<button *ngIf="0" [disabled]="selectedTerritory.displayQueue.length==0" (click)="clearQueue()"
							type="button" class="btn btn-secondary roundButton">Clear</button>
					</div>
				</div>
				<!------------------Production----------------------------->
				<div *ngIf="optionType=='production'">
					<div style="background-color: #007; color: white;"><img src="assets/graphics/units/piece15u.png"
							height=20> {{selectedTerritory.name}} Production</div>


					<!---------technology--------->
					<div *ngIf="selectedTerritory.factoryCount>0"
						style="background-color: #cdf; border: 1px solid black; border-radius: 5px;">
						<div class="darkBlueBg" style="font-size: 10px;"><i class="fa fa-flask"></i> Technology</div>
						<table class="spTable">
							<tr>
								<td>
									<button [disabled]="currentPlayer.money<10 || currentPlayer.abFlg"
										*ngIf="!currentPlayer.tech[18]" (click)="addUniToQueue(16,1)" type="button"
										class="btn btn-primary roundButton" title="Anti-Balistics"><i
											class="fa fa-shield"></i></button>
									<div *ngIf="currentPlayer.tech[18]" style="font-size: 18px;"><i class="fa fa-check"
											style="color: green;"></i><i class="fa fa-shield"></i></div>
									<div style="font-size: 8px;">Anti-Balistics</div>
								</td>
								<td>
									<button [disabled]="currentPlayer.money<10 || currentPlayer.railFlg"
										*ngIf="!currentPlayer.tech[19]" (click)="addUniToQueue(17,1)" type="button"
										class="btn btn-primary roundButton" title="Railway"><i
											class="fa fa-train"></i></button>
									<div *ngIf="currentPlayer.tech[19]" style="font-size: 18px;"><i class="fa fa-check"
											style="color: green;"></i><i class="fa fa-train"></i></div>
									<div style="font-size: 8px;">Railway</div>
								</td>
								<td>
									<button [disabled]="currentPlayer.money<10" *ngIf="currentPlayer.techCount<18"
										(click)="addUniToQueue(18,1)" type="button"
										class="btn btn-primary roundButton"><i class="fa fa-flask"></i>
										Research ({{currentPlayer.techCount}})</button>
									<div *ngIf="currentPlayer.techCount>=18" style="font-size: 18px;"><i
											class="fa fa-check" style="color: green;"></i><i class="fa fa-flask"></i>
									</div>
									<div style="font-size: 8px;">Technology</div>
								</td>
								<td>
									<button (click)="infoFlg=!infoFlg" type="button"
										class="btn btn-secondary roundButton"><i class="fa fa-info-circle"></i></button>
									<div style="font-size: 8px;">Info</div>
								</td>
							</tr>
						</table>
						<div class="borderClass2" *ngIf="infoFlg">
							<i class="fa fa-flask"></i> <b>Technology:</b> You can purchase upgrades or fund research
							for 10 coins each. See the Technology tab at the top of the board for more info.
						</div>
					</div>
					<!---------queue--------->
					<div style="background-color: #cdf; border: 1px solid black; border-radius: 5px;">
						<div class="darkBlueBg" style="font-size: 10px;"><i class="fa fa-building-o"></i> Production
							Queue
						</div>
						<img src="assets/graphics/units/piece15u.png" height=20 title="Queue">: <span
							style="border: 1px solid black; height: 15px; min-width: 15px;"><span
								*ngIf="selectedTerritory.displayQueue.length==0">&nbsp;</span>
							<span *ngFor="let unit of selectedTerritory.displayQueue"><img *ngIf="unit.piece>0"
									src="{{ngUnitSrc(unit.piece, 1)}}" height=15><span
									*ngIf="unit.count>1">({{unit.count}})</span></span>
						</span>
						<button [disabled]="selectedTerritory.displayQueue.length==0" (click)="clearQueue()"
							type="button" class="btn btn-secondary roundButton">Clear</button>
					</div>
					<!---------purchase form--------->
					<div class="btn-group" *ngIf="selectedTerritory.factoryCount>0">
						<button (click)="changeProdType(0)" [ngClass]="ngClassSegment(segmentIdx,0)" type="button"
							class="btn btn-default"><i class="fa fa-truck"></i> Ground</button>
						<button (click)="changeProdType(1)" [ngClass]="ngClassSegment(segmentIdx,1)" type="button"
							class="btn btn-default"><i class="fa fa-fighter-jet"></i> Air</button>
						<button (click)="changeProdType(2)" [ngClass]="ngClassSegment(segmentIdx,2)" type="button"
							class="btn btn-default"><i class="fa fa-anchor"></i> Sea</button>
						<button *ngIf="gameObj.restrict_units_flg !='Y' && user.rank>=0" (click)="changeProdType(3)"
							[ngClass]="ngClassSegment(segmentIdx,3)" type="button" class="btn btn-default"><i
								class="fa fa-star"></i> Sp</button>
					</div>
					<div *ngIf="segmentIdx==2 && selectedTerritory.id<79" style="padding: 20px; color: #800;">
						<i class="fa fa-exclamation-triangle"></i> Click on sea zones to build new ships</div>
					<div *ngIf="segmentIdx!=2 || selectedTerritory.id>=79" class="listborder">
						<table class="spTable">
							<tr>
								<td></td>
								<td style="min-width: 25px;" align=center><img src="assets/graphics/images/coin.png"
										height=20 title="cost"></td>
								<td style="min-width: 25px;" align=center>
									<font color=black><i class="fa fa-arrows-alt" title="Movement"></i></font>
								</td>
								<td style="min-width: 25px;" align=center>
									<font color=#900><i class="fa fa-bolt" title="Attack"></i></font>
								</td>
								<td style="min-width: 25px;" align=center>
									<font color=blue><i class="fa fa-shield" title="Defend"></i></font>
								</td>
								<td></td>
							</tr>
							<tr *ngFor="let unit of productionDisplayUnits">
								<td style="font-size: 8px;" align=center>
									<img (click)="unitDetailPopup.show(unit, true)" src="{{ngUnitSrc(unit.id, 1)}}"
										style="max-width: 60px; max-height: 40px; cursor: pointer;"
										title="{{unit.name}}"><br>{{unit.name}}</td>
								<td align=center>
									<font color=#c80><b>{{unit.cost}}</b></font>
								</td>
								<td align=center>
									<font color=black>{{unit.move}}</font>
								</td>
								<td align=center>
									<font color=#900>{{unit.att}} <span *ngIf="unit.numAtt>1">x
											{{unit.numAtt}}</span></font>
								</td>
								<td align=center>
									<font color=blue>{{unit.def}}</font>
								</td>
								<td>
									<button [disabled]="currentPlayer.money<unit.cost" id="{{'buy'+unit.id}}"
										(click)="addUniToQueue(unit.id, 1)" type="button"
										class="btn btn-secondary roundButton"><i class="fa fa-lock"
											*ngIf="unit.locked"></i><span ng-hide="unit.locked">buy</span></button>
									<button *ngIf="unit.id != 12" [disabled]="currentPlayer.money<unit.cost*2"
										id="{{'buy5'+unit.id}}" (click)="addUniToQueue(unit.id, 5)" type="button"
										class="btn btn-secondary roundButton">x5</button>
								</td>
							</tr>
							<!------factory-->
							<tr *ngIf="selectedTerritory.factoryCount==0 && selectedTerritory.id<79">
								<td style="font-size: 8px;" align=center><img
										(click)="unitDetailPopup.show(superpowersData.units[15], true)"
										src="{{ngUnitSrc(15, 1)}}"
										style="max-width: 60px; max-height: 40px; cursor: pointer;"
										title="Factory"><br>Factory</td>
								<td align=center>
									<font color=#c80>15</font>
								</td>
								<td align=center>
									<font color=black>0</font>
								</td>
								<td align=center>
									<font color=#900>0</font>
								</td>
								<td align=center>
									<font color=blue>0</font>
								</td>
								<td>
									<button [disabled]="currentPlayer.money<15" id="buy15"
										(click)="addUniToQueue(15, 1)" type="button"
										class="btn btn-secondary roundButton">buy</button>
								</td>
							</tr>
							<!------emp-->
							<tr *ngIf="segmentIdx==2 && selectedTerritory.id<79 && gameObj.mmFlg"
								class="tableRowClickable2">
								<td style="font-size: 8px;" align=center><img ng-click="unitPopup(52)"
										src="assets/graphics/units/piece52u.png"
										style="max-width: 40px; max-height: 40px;" title="EMP Blast"><br>EMP</td>
								<td align=center>
									<font color=#c80><b>0</b></font>
								</td>
								<td align=center>
									<font color=black>1</font>
								</td>
								<td align=center>
									<font color=#900>36</font>
								</td>
								<td align=center>
									<font color=blue>-</font>
								</td>
								<td>
									<button id="buyEMP" ng-click="buyEmp()" type="button"
										class="btn btn-secondary roundButton">buy</button>
								</td>
							</tr>
						</table>
						<div *ngIf="selectedTerritory.facBombedFlg && segmentIdx==0"><img
								src="assets/graphics/units/piece103.gif" height=20 title="Repair bombed factory"> <i
								class="fa fa-arrow-right"></i>
							<img src="assets/graphics/units/piece15.gif" height=20 title="Repair bombed factory">
							<font color=#fc0>15</font> <button id="" ng-click="addUniToQueue(19, 1)" type="button"
								class="btn btn-secondary roundButton">buy</button>
						</div>
						<div style="padding: 10px;">
							<img src="assets/graphics/images/coin.png" height=30 title="coins"> Coins: <span
								class="money">{{currentPlayer.money}}</span>
						</div>
					</div>
				</div>
				<!------------------end Production----------------------------->

				<app-terr-advice
					*ngIf="ableToTakeThisTurn && optionType=='home' && selectedTerritory.leaderMessage.length>0"
					[selectedTerritory]="selectedTerritory" [currentPlayer]="currentPlayer"
					[superpowersData]="superpowersData" [gameObj]="gameObj" [user]="user"></app-terr-advice>





			</div>
			<!--modal-body-->
			<div class="modal-header" style="background-color: #337ab7;  border: 0">
				<button (click)="closeModal('#territoryPopup')" type="button"
					class="btn btn-secondary roundButton">Close</button>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
		</div>
	</div>
</div>




<app-unit-detail-popup #unitDetailPopup></app-unit-detail-popup>