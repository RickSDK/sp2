<div class="modal fade" id="territoryPopup" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document" style="max-width: 400px;">
		<div class="modal-content" *ngIf="selectedTerritory">
			<div class="modal-header"
				style="line-height: 40px; vertical-align: middle; background-color: #337ab7;  border: 0">
				<img *ngIf="selectedTerritory" src="assets/graphics/images/{{selectedTerritory.flag || 'flag1.gif'}}"
					title="{{superpowersData.superpowers[selectedTerritory.owner]}}" height=40>
				&nbsp;<span style="color: yellow; font-size: 12px;">[{{selectedTerritory.id}}]</span>
				&nbsp;<span style="font-size: 24px; font-weight: 700;">{{selectedTerritory.name}}</span>
				&nbsp;<span style="color: #ccc;">{{selectedTerritory.userName}}</span>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body" style="padding: 0; text-align: center;">

				<app-terr-header [selectedTerritory]="selectedTerritory"></app-terr-header>

				<div *ngIf="displayBattle && optionType == 'battle'">
					<div *ngIf="currentPlayer.nation<=6 && displayBattle.generalUnit>0" style="background-color: #ccf;">
						<img src="assets/graphics/units/piece10u.png" height=20>
						General
						took out unit <img src="{{ngUnitSrc(displayBattle.generalUnit)}}" height=20></div>
					<div *ngIf="currentPlayer.nation==4 && displayBattle.generalUnit>0" style="background-color: #ccf;">
						<img src="assets/graphics/units/piece10u.png" height=20>
						General
						converted unit <img src="{{ngUnitSrc(displayBattle.generalUnit)}}" height=20></div>
					<div *ngIf="displayBattle.hijackerUnit>0" style="background-color: #ccf;"><img
							src="assets/graphics/units/piece41u.png" height=20> Hijacker converted unit <img
							src="{{ngUnitSrc(displayBattle.hijackerUnit)}}" height=20></div>
					<div *ngIf="displayBattle.medicHealedCount>0" style="background-color: #ccf;"><img
							src="assets/graphics/units/piece28u.png" height=20> Medic Heals:
						{{displayBattle.medicHealedCount}} <img src="{{ngUnitSrc(2)}}" height=20></div>
					<div *ngIf="displayBattle.subsDove" style="background-color: #ccf;"><img
							src="assets/graphics/units/piece5u.png" height=20> Remaining Subs dove to avoid planes.
					</div>


					<div style="border: 1px solid black; background-color: #fc0;">
						<div style="font-size: 11px;">Air Defense <span
								*ngIf="displayBattle.airDefenseUnits.length==0">(none)</span></div>
						<div *ngIf="displayBattle.airDefenseUnits.length>0">
							<div style="display: inline-block;" *ngFor="let unit of displayBattle.airDefenseUnits">
								<img *ngIf="unit.piece>0" src="{{ngUnitSrc(unit.piece, unit.nation)}}" height=20><br>
								<img *ngFor="let dice of unit.dice" src="assets/graphics/dice/{{dice}}" height=20
									width=20>
							</div>
						</div>
					</div>

					<table border=1 width=100%>
						<tr style="background-color: #fcc;">
							<td colspan=5><img src="assets/graphics/images/flag{{displayBattle.attNation}}.gif"
									height=20>
								<font color=red><b>Attacking Forces</b></font> <span
									*ngIf="displayBattle.phase>2">(hits: {{displayBattle.attHits}})</span>
							</td>
						</tr>
						<tr style="background-color: #fcc;">
							<td *ngFor="let i of boardCols">
								<div *ngFor="let unit of displayBattle.attackUnits" style="display: inline-block;">
									<span *ngIf="unit.att==i || i==5 && unit.att==6">
										<img *ngIf="unit.piece>0" src="{{ngUnitSrc(unit.piece, unit.nation)}}"
											height=20><br>
										<img *ngFor="let dice of unit.dice" src="assets/graphics/dice/{{dice}}"
											height=20 width=20>
									</span>
								</div>
							</td>
						</tr>
						<tr style="font-weight: 900; color: gray;">
							<td>1</td>
							<td>2</td>
							<td>3</td>
							<td>4</td>
							<td>5+</td>
						</tr>
						<tr style="background-color: #ccf;" *ngIf="selectedTerritory.fogOfWar">
							<td colspan=5>-Fog of War-</td>
						</tr>
						<tr style="background-color: #ccf;" *ngIf="!selectedTerritory.fogOfWar">
							<td *ngFor="let i of boardCols">
								<div *ngFor="let unit of displayBattle.defendingUnits" style="display: inline-block;">
									<span *ngIf="unit.def==i || i==5 && unit.def==6">
										<img *ngIf="unit.piece>0" src="{{ngUnitSrc(unit.piece, unit.nation)}}"
											height=20><br>
										<img *ngFor="let dice of unit.dice" src="assets/graphics/dice/{{dice}}"
											height=20 width=20>
									</span>
								</div>
							</td>
						</tr>
						<tr style="background-color: #ccf;">
							<td colspan=5><img src="assets/graphics/images/flag{{displayBattle.defNation}}.gif"
									height=20>
								<font color=blue><b>Defending Forces</b></font> <span
									*ngIf="displayBattle.phase>3">(hits: {{displayBattle.defHits}})</span>
							</td>
						</tr>
					</table>
					<table class="spTable" border=1>
						<tr>
							<td width="80"><img src="assets/graphics/advisors/general1.jpg" height="60"></td>
							<td valign="top">
								<div class="darkBlueBg" style="font-size: 12px;">Military Analysis</div>
								<div style="font-size: 12px; color: gray;">Expected Hits: <span class="bgHighlight">{{expectedHits}}</span>, Expected Losses: <span class="bgHighlight">{{expectedLosses}}</span></div>
								<div style="color: green; font-weight: 500;"><i>"{{displayBattle.militaryMessage}}"</i></div>
							</td>
						</tr>
					</table>












				</div>
				<!--end The Battlefield-->

				<app-terr-buttons
					*ngIf="ableToTakeThisTurn && currentPlayer.status!='Purchase' && optionType != 'battle'"
					[selectedTerritory]="selectedTerritory" [currentPlayer]="currentPlayer"
					[superpowersData]="superpowersData" [gameObj]="gameObj" [user]="user" [optionType]="optionType"
					[ableToTakeThisTurn]="ableToTakeThisTurn" (messageEvent)="buttonClicked($event)"></app-terr-buttons>

				<app-terr-units *ngIf="optionType=='home' || optionType=='production'"
					[selectedTerritory]="selectedTerritory" [currentPlayer]="currentPlayer"
					[superpowersData]="superpowersData" [gameObj]="gameObj" [user]="user">
				</app-terr-units>


				<!-- troop selection panel -->
				<div *ngIf="ableToTakeThisTurn && optionType!='home' && currentPlayer.status!='Purchase' && optionType != 'battle'"
					class="terr-card">
					<div *ngIf="loadingFlg" class="progress-bar progress-bar-info progress-bar-striped"
						role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">
						Busy...
					</div>
					<div *ngIf="!loadingFlg" style="background-color: #ccc; color: black;">
						<div
							*ngIf="(optionType=='movement' || optionType=='loadUnits') && selectedTerritory.nation==99 && selectedTerritory.unitCount>0">
							<button *ngIf="optionType=='movement'" (click)="optionType='loadUnits'" type="button"
								class="btn btn-success roundButton"><i class="fa fa-ship"></i> Custom Load
								Options</button>
							<button *ngIf="optionType=='loadUnits'" (click)="optionType='movement'" type="button"
								class="btn btn-success roundButton"><i class="fa fa-ship"></i> Auto Load</button>

							<button (click)="infoFlg = !infoFlg" type="button" class="btn btn-secondary roundButton"><i
									class="fa fa-info-circle"></i> Info</button>
							<div *ngIf="infoFlg" class="borderClass2">
								<div>Cargo Limits</div>
								<table class="spTable">
									<tr>
										<th>Ship</th>
										<th>Cargo</th>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece4u.png" height=30></td>
										<td><img src="assets/graphics/units/piece2u.png" height=30><img
												src="assets/graphics/units/piece2u.png" height=30><img
												src="assets/graphics/units/piece2u.png" height=30><img
												src="assets/graphics/units/piece2u.png" height=30></td>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece4u.png" height=30></td>
										<td><img src="assets/graphics/units/piece3u.png" height=30><img
												src="assets/graphics/units/piece3u.png" height=30></td>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece8u.png" height=30></td>
										<td><img src="assets/graphics/units/piece6u.png" height=30><img
												src="assets/graphics/units/piece6u.png" height=30></td>
									</tr>
									<tr>
										<td><img src="assets/graphics/units/piece12u.png" height=30></td>
										<td><img src="assets/graphics/units/piece13u.png" height=30><img
												src="assets/graphics/units/piece10u.png" height=30><img
												src="assets/graphics/units/piece11u.png" height=30></td>
									</tr>
								</table>
								<div> all ships can carry heros and AA guns.</div>
							</div>
							<div *ngIf="optionType=='movement'">Select units to load. They will automatically be loaded
								onto ships.</div>
							<div *ngIf="optionType=='loadUnits'">Select one ship plus cargo you want to load.</div>
						</div>

						<div *ngIf="optionType=='loadPlanes'" class="borderClass">Select units to load as paratroopers.
							<button (click)="infoFlg = !infoFlg" type="button" class="btn ptp-gray roundButton"
								style=""><i class="fa fa-info-circle"></i>Info</button>
							<div *ngIf="infoFlg">Each bomber can carry up to 2 infantry, plus hero units. Only select
								the infantry. Bombers are chosen automatically for you.</div>
						</div>

						<!--     each terr-->
						<div *ngFor="let terr of moveTerr; let i = index" [ngStyle]="ngStyleLogs(terr.nation)"
							class="terrClass" style="border: 1px solid black;">
							<div style="padding-left: 5px; font-size: 18px; font-weight: 700; text-align: left;">
								{{terr.name}}
								<span style="float: right;">
									<span *ngIf="terr.movableTroopCount >= 2" style="font-size: 10px;">Select All
									</span>
									<div *ngIf="terr.units.length>=2" class="squaredOne squaredOneGreen"
										style="display: inline-block; padding: 0; margin: 1px;">
										<input (click)="selectAllUnitsForTerr(terr)" type="checkbox" value="None"
											id="{{'ter'+terr.id}}" name="check" />
										<label for="{{'ter'+terr.id}}"></label>

									</div>
								</span>
							</div>
							<hr style="padding: 0; margin: 5px;">
							<div *ngFor="let unit of terr.units" style="display: inline-block;">
								<span *ngIf="checkMovement(terr.distObj, unit, optionType)">
									<div (click)="checkSendButtonStatus(unit)" class="squaredOne"
										style="display: inline-block; padding: 0; margin: 1px;">
										<input type="checkbox" value="None" id="{{'unit'+unit.id}}" name="check" />
										<label for="{{'unit'+unit.id}}"></label>
									</div> <i class="fa fa-hourglass-half"
										*ngIf="unit.piece==28 && gameObj.round-1 == unit.medicRound"></i>
									<span style="margin-right: 10px;"> <img *ngIf="unit.piece>0"
											ng-click="unitPopup(unit.piece)"
											src="{{ngUnitSrc(unit.piece, unit.nation)}}" height=20
											title="{{unit.name}}"><span *ngIf="unit.cargoOf>0">(c)</span><span
											*ngFor="let cargo of unit.cargo"><img src="{{ngUnitSrc(cargo.piece)}}"
												height=10></span></span>
								</span>
							</div>
							<div *ngIf="selectedUnitForm==terr.id"
								style="margin-top: 5px; border: 1px solid gray; display: block; white-space: nowrap;">
								({{selectedFormUnit.max}})
								<img ng-if="1" ng-click="unitPopup(2)" src="{{ngUnitSrc(selectedFormUnit.piece, 1)}}"
									style="max-height: 30px; max-width: 40px;">
								<button disabled id="unitCountToOne" ng-click="unitCountToZero(terr)" type="button"
									class="btn btn-primary tight roundButton"><i
										class="fa fa-fast-backward"></i></button>
								<button disabled id="unitCountDown" ng-click="unitCountDownF(terr)" type="button"
									class="btn btn-primary tight roundButton"><i class="fa fa-backward"></i></button>
								<button id="unitCountUp" ng-click="unitCountUpF(terr)" type="button"
									class="btn btn-primary tight roundButton"><i class="fa fa-forward"></i></button>
								<button id="unitCountToMax" ng-click="setUnitCountToMax(terr)" type="button"
									class="btn btn-primary tight roundButton"><i
										class="fa fa-fast-forward"></i></button>
								<span
									style="background-color: white; border: 1px solid black; font-size: 18px; padding: 1px;">{{selectedFormUnit.num}}</span>
							</div>

						</div> <!-- each terr-->
						<div *ngIf="hostileMessage.length>0 && totalUnitsThatCanMove>0"
							style="background-color: yellow; color: red; font-weight: 700;"><i
								class="fa fa-exclamation-triangle"></i> {{hostileMessage}}</div>
						<div *ngIf="totalUnitsThatCanMove==0" style="background-color: yellow; border: 1px solid red;">
							<div style="color: red; font-weight: 700;"><i class="fa fa-exclamation-triangle"></i> None
								of your units can reach {{selectedTerritory.name}}!</div>
							<div *ngIf="gameObj.round<6 && !gameObj.multiPlayerFlg" style="font-size: 12px;">This may be
								due to all your units
								having used up their moves for this turn. Click 'Complete Turn' to move to next turn.
							</div>
						</div>
						<div>
							<button *ngIf="optionType=='attack'" [disabled]="totalUnitsThatCanMove==0"
								(click)="autoButtonPressed()" type="button" class="btn btn-secondary roundButton"><i
									class="fa fa-check-square-o"></i> Auto</button>
							<button (click)="selectAllButtonChecked()" type="button"
								[disabled]="totalUnitsThatCanMove==0" class="btn btn-secondary roundButton"><i
									class="fa fa-check-square-o"></i> All</button>
							<button (click)="moveTroopsButtonPressed()" [disabled]="expectedHits==0" type="button"
								class="btn btn-success roundButton" style="min-width: 120px; height: 50px;"><i
									class="fa fa-arrow-right"></i> Go</button>

						</div>
						<div *ngIf="optionType=='attack' || optionType=='cruise' || optionType=='nuke'"
							style="font-size: 12px;">
							Expected Hits: <span class="highlightField">{{expectedHits}}</span>
							Expected Losses: <span class="highlightField">{{expectedLosses}}</span>
						</div>


					</div>
				</div>
				<!-- end troop selection panel -->

				<!------------------Production Queue----------------------------->
				<div *ngIf="optionType=='home' && selectedTerritory.treatyStatus==4 && selectedTerritory.displayQueue.length>0"
					class="terr-card">
					<div style="font-size: 10px; color: white;"><i class="fa fa-building-o"></i> Production
						Queue
					</div>
					<div style="background-color: white;">
						<span *ngIf="selectedTerritory.displayQueue.length==0">&nbsp;</span>
						<span *ngFor="let unit of selectedTerritory.displayQueue"><img *ngIf="unit.piece>0"
								src="{{ngUnitSrc(unit.piece, 1)}}" height=20
								title="{{superpowersData.units[unit.piece].name}}"><span
								*ngIf="unit.count>1">({{unit.count}})</span>
						</span>
					</div>
				</div>

				<app-terr-purchase *ngIf="optionType=='production'" [selectedTerritory]="selectedTerritory"
					[currentPlayer]="currentPlayer" [superpowersData]="superpowersData" [gameObj]="gameObj"
					[user]="user" [optionType]="optionType" [ableToTakeThisTurn]="ableToTakeThisTurn"
					[productionDisplayUnits]="productionDisplayUnits"
					[allowEcoCenterFlg]="selectedTerritory.factoryCount==1"
					[allowFactoryFlg]="selectedTerritory.factoryCount==0"></app-terr-purchase>

				<app-terr-advice
					*ngIf="ableToTakeThisTurn && optionType=='home' && selectedTerritory.leaderMessage.length>0"
					[selectedTerritory]="selectedTerritory" [currentPlayer]="currentPlayer"
					[superpowersData]="superpowersData" [gameObj]="gameObj" [user]="user"></app-terr-advice>

			</div>
			<!--modal-body-->

			<div class="modal-header" style="background-color: #337ab7;  border: 0">
				<button (click)="closeModal('#territoryPopup')" type="button"
					class="btn btn-secondary roundButton">Close</button>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
		</div>
	</div>
</div>




<app-unit-detail-popup #unitDetailPopup></app-unit-detail-popup>